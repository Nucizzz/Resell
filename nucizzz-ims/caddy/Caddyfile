{
	email admin@nucizzz.shop
}

http://app.nucizzz.shop {
	@api path /api/*
	handle @api {
		reverse_proxy 127.0.0.1:8000
	}

	handle {
		respond "Use HTTPS" 308
	}
}

https://app.nucizzz.shop {
	# Phase 1: works with Cloudflare Flexible
	tls internal
	# Phase 2 (Full strict): uncomment and provide Origin Cert + key
	# tls /etc/ssl/certs/cloudflare-origin.pem /etc/ssl/private/cloudflare-origin.key

	log {
		output file /var/log/caddy/app.access.log
		format console
		level INFO
	}

	@api path /api/*
	handle @api {
		reverse_proxy 127.0.0.1:8000 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	handle {
		root * /srv
		try_files {path} /index.html
		encode gzip
		file_server
	}

	header {
		Access-Control-Allow-Origin "*"
		Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
		Access-Control-Allow-Headers "Content-Type, Authorization"
		Access-Control-Allow-Credentials "true"
	}

	@options method OPTIONS
	respond @options 204
}
